@using System.Security.Claims
@model IList<Claim>

@{
    ViewData["Title"] = "Claims Authorization";
}

<div class="container-xxl py-5">
    <div class="page-shell">

        <div class="page-head">
            <div>
                <h1 class="page-title">Ph√¢n quy·ªÅn Claims</h1>
                <p class="page-subtitle">Qu·∫£n l√Ω ƒë·∫∑c quy·ªÅn tr·ª±c ti·∫øp cho: <strong style="color: var(--accent)">@ViewBag.UserName</strong></p>
            </div>
            
            <a asp-action="Index" class="btn-primary-soft" style="background: transparent; border-color: var(--border); color: var(--muted)">
                ‚Üê Quay l·∫°i danh s√°ch
            </a>
        </div>

        <div class="data-card mb-4" style="background: rgba(255,255,255,.02); padding: 24px;">
            <form asp-action="AddClaim" method="post" class="row g-3 align-items-end">
                <input type="hidden" name="userId" value="@ViewBag.UserId" />
                
                <div class="col-md-8">
                    <label class="user-hint mb-2 d-block">Ch·ªçn ƒë·∫∑c quy·ªÅn h·ªá th·ªëng (Claim Type)</label>
                    <select name="claimType" class="search-input" style="padding-left: 15px;">
                        <option value="CreateProduct">Quy·ªÅn T·∫°o S·∫£n Ph·∫©m (CreateProduct)</option>
                        <option value="Admin">Quy·ªÅn Qu·∫£n Tr·ªã (Admin)</option>
                        <option value="Sales">Quy·ªÅn Kinh Doanh (Sales)</option>
                    </select>
                </div>
                
                <div class="col-md-4">
                    <button type="submit" class="btn-save-enterprise w-100" style="background: var(--accent); color: #020617;">
                        K√≠ch ho·∫°t Claim
                    </button>
                </div>
            </form>
        </div>

        <div class="data-card">
            <div class="table-responsive">
                <table class="table data-table align-middle">
                    <thead>
                        <tr>
                            <th>Lo·∫°i ƒë·∫∑c quy·ªÅn (Claim Type)</th>
                            <th>Gi√° tr·ªã (Value)</th>
                            <th class="text-end">Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.Any())
                        {
                            @foreach (var claim in Model)
                            {
                                <tr>
                                    <td>
                                        <div class="user-cell">
                                            <div class="avatar" style="background: #334155; color: var(--accent); font-size: 14px;">
                                                CL
                                            </div>
                                            <div class="user-email">@claim.Type</div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="id-pill" style="background: #e0f2fe; color: #0369a1; border: none;">
                                            @claim.Value
                                        </span>
                                    </td>
                                    <td class="text-end">
                                        <form asp-action="RemoveClaim" method="post" onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën thu h·ªìi ƒë·∫∑c quy·ªÅn n√†y?')" class="d-inline">
                                            <input type="hidden" name="userId" value="@ViewBag.UserId" />
                                            <input type="hidden" name="claimType" value="@claim.Type" />
                                            <input type="hidden" name="claimValue" value="@claim.Value" />
                                            <button type="submit" class="btn-revoke">
                                                Thu h·ªìi
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="3" class="text-center py-5" style="color: var(--muted); background: #fff;">
                                    T√†i kho·∫£n n√†y hi·ªán ch∆∞a ƒë∆∞·ª£c c·∫•p ƒë·∫∑c quy·ªÅn Claim n√†o.
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="table-foot">
                üí° L∆∞u √Ω: Claims ƒë∆∞·ª£c s·ª≠ d·ª•ng cho ph√¢n quy·ªÅn chi ti·∫øt (Fine-grained Authorization) v∆∞·ª£t ngo√†i ph·∫°m vi c·ªßa Roles.
            </div>
        </div>

    </div>
</div>

<style>
    /* B·ªï sung Style cho trang Claims */
    
    .btn-revoke {
        background: #fff1f2;
        color: #be123c;
        border: 1px solid #fecdd3;
        padding: 6px 14px;
        border-radius: 10px;
        font-weight: 600;
        font-size: 0.85rem;
        transition: .2s;
    }

    .btn-revoke:hover {
        background: #be123c;
        color: #fff;
        transform: scale(1.05);
    }

    /* ƒê·∫£m b·∫£o b·∫£ng trong card lu√¥n s√°ng s·ªßa v√† ƒë√∫ng chu·∫©n Enterprise */
    .data-table tbody tr td {
        background: #fff;
        border-bottom: 1px solid var(--border-soft);
    }

    .data-table tbody tr:hover td {
        background: #f8fafc;
    }

    /* Custom l·∫°i Select ƒë·ªÉ ƒÉn theo Style Search Input */
    select.search-input {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        background-size: 16px;
    }
</style>