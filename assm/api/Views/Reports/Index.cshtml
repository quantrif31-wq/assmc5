@{
    ViewData["Title"] = "Business Dashboard";
}

<style>
    /* Container chính đồng bộ với trang Home */
    .dashboard-wrap {
        width: min(1200px, calc(100% - 64px));
        margin: 22px auto 0;
        position: relative;
        z-index: 1;
    }

    /* Tiêu đề chữ rỗng phong cách WELCOME */
    .dashboard-title {
        font-weight: 900;
        letter-spacing: .1em;
        font-size: clamp(24px, 4vw, 36px);
        text-transform: uppercase;
        color: transparent;
        -webkit-text-stroke: 1.5px rgba(0,0,0,.35);
        margin-bottom: 25px;
    }

    /* Grid các thẻ chỉ số (Metrics) */
    .metric-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .metric-card {
        padding: 24px;
        background: rgba(255, 255, 255, 0.45);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 18px;
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 15px 35px rgba(0,0,0,0.05);
        transition: transform 0.3s ease;
    }

    .metric-card:hover {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.6);
    }

    .metric-label {
        display: block;
        font-size: 11px;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: rgba(0,0,0,0.45);
        margin-bottom: 8px;
    }

    .metric-value {
        font-size: 22px;
        font-weight: 900;
        color: var(--ink);
        display: block;
    }

    /* Vùng chứa biểu đồ */
    .chart-panel {
        padding: 30px;
        background: rgba(255, 255, 255, 0.4);
        backdrop-filter: blur(12px);
        border-radius: 22px;
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 18px 40px rgba(0,0,0,0.08);
    }
</style>

<div class="dashboard-wrap">
    <h2 class="dashboard-title">Business Analytics</h2>

    <div class="metric-grid">
        <div class="metric-card">
            <span class="metric-label">💰 Doanh thu thực</span>
            <span class="metric-value" style="color: #2e7d32;">@ViewBag.TotalRevenue.ToString("N0") ₫</span>
        </div>

        <div class="metric-card">
            <span class="metric-label">⏳ Doanh thu dự kiến</span>
            <span class="metric-value" style="color: #f08c00;">@ViewBag.ExpectedRevenue.ToString("N0") ₫</span>
        </div>

        <div class="metric-card">
            <span class="metric-label">🧾 Hiệu suất đơn hàng</span>
            <span class="metric-value">
                @ViewBag.TotalOrders <small style="font-size: 13px; font-weight: 600; color: #2e7d32;">(@ViewBag.CompletedOrders Done)</small>
            </span>
        </div>

        <div class="metric-card">
            <span class="metric-label">📦 Tổng tồn kho</span>
            <span class="metric-value">@ViewBag.TotalInventory <small style="font-size: 12px; opacity: 0.5;">Units</small></span>
        </div>
    </div>

    <div class="chart-panel">
        <span class="metric-label" style="margin-bottom: 20px;">📈 Biểu đồ tăng trưởng doanh thu</span>
        
        <canvas id="revenueChart" style="max-height: 400px;"></canvas>
    </div>
</div>

@* Sparkle SVG trang trí đồng bộ *@
<svg class="sparkle" viewBox="0 0 64 64" style="position: fixed; right: 40px; bottom: 40px; width: 60px; height: 60px; opacity: .1; pointer-events: none;">
    <path fill="var(--ink)" d="M32 6l4.2 16.4L52 26.7 35.8 31 32 47 28.2 31 12 26.7l15.8-4.3z" />
</svg>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const revenueData = @Html.Raw(Json.Serialize(ViewBag.RevenueByDay));
    
    // Cấu hình Chart.js đồng bộ với phong cách Ink/Glass
    const ctx = document.getElementById('revenueChart').getContext('2d');
    
    // Tạo gradient cho đường biểu đồ
    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
    gradient.addColorStop(0, 'rgba(0, 0, 0, 0.1)');
    gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: revenueData.map(x => x.date),
            datasets: [{
                label: 'Doanh thu (₫)',
                data: revenueData.map(x => x.total),
                fill: true,
                backgroundColor: gradient,
                borderColor: '#2c2c2c', // Màu var(--ink)
                borderWidth: 3,
                tension: 0.4,
                pointBackgroundColor: '#fff',
                pointBorderColor: '#2c2c2c',
                pointHoverRadius: 6
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(0,0,0,0.05)' },
                    ticks: { font: { size: 11, weight: '600' } }
                },
                x: {
                    grid: { display: false },
                    ticks: { font: { size: 11, weight: '600' } }
                }
            }
        }
    });
</script>